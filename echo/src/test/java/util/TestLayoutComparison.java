package util;

import java.util.Arrays;
import java.util.function.BiConsumer;

import org.junit.Test;
import org.xmlunit.diff.Diff;

import monkey.Main;
import monkey.util.AppInfoWrapper;
import monkey.util.Env;
import monkey.util.TestingOptions;

/**
 * Test the class LayOutComparison
 */
public class TestLayoutComparison {
	@Test
	public void test1() {
		LayoutComparison.diff(a, b);
	}
	
	@Test
	public void test2() {
		LayoutComparison.diff(a, a);
	}
	
	@Test
	public void test3() {
		System.out.println(LayoutComparison.hasDiff(a, b));
	}
	
	@Test
	public void test4() {
		Diff diff = LayoutComparison.getDiff(a, b);
		diff.getDifferences().forEach(System.out::println);
	}
	
	/**
	 * Look into the XML page source.
	 */
	@Test
	public void test5() {
		initTesting("8", (info, env) -> {
			String a = env.driver().getPageSource();
			String b = env.driver().getPageSource();
			Diff diff = LayoutComparison.getDiff(a, b);
			diff.getDifferences().forEach(System.out::println);
			System.out.println(diff.hasDifferences());
			String c = env.driver().getPageSource();
			diff = LayoutComparison.getDiff(b, c);
			diff.getDifferences().forEach(System.out::println);
			System.out.println(diff.hasDifferences());
		});
	}
	
	/**
	 * Initialize Appium testing
	 */
	private void initTesting(String id, BiConsumer<AppInfoWrapper, Env> testing) {
		Config.init(null);
		String[] args = new String[] {"-app", id, "-emulator", "Nexus_5_API_19"};
		TestingOptions.v().processOptions(args);
		TestingOptions.v().getAppPaths().stream().map(AppInfoWrapper::new).forEach(i -> Main.testingApp(i, testing));
	}
	
	// Test the DOM parsing and attribute removal.
	@Test
	public void test6() {
		System.out.println(LayoutComparison.removeIgnorableAttributes(a, Arrays.asList("selected")));
		System.out.println(LayoutComparison.removeIgnorableAttributes(b, Arrays.asList("selected")));
	}
	
	private String a = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><hierarchy rotation=\"0\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,0][1080,1775]\" resource-id=\"\" instance=\"0\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,0][1080,1775]\" resource-id=\"\" instance=\"0\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,74][1080,159]\" resource-id=\"\" instance=\"1\"><android.widget.TextView index=\"0\" text=\"Bites\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[20,78][1060,152]\" resource-id=\"android:id/title\" instance=\"0\"/></android.widget.FrameLayout><android.widget.FrameLayout index=\"1\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,1775]\" resource-id=\"android:id/content\" instance=\"2\"><android.widget.TabHost index=\"0\" text=\"\" class=\"android.widget.TabHost\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,1775]\" resource-id=\"android:id/tabhost\" instance=\"0\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,1775]\" resource-id=\"\" instance=\"1\"><android.widget.TabWidget index=\"0\" text=\"\" class=\"android.widget.TabWidget\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,375]\" resource-id=\"android:id/tabs\" instance=\"0\"><android.widget.RelativeLayout index=\"0\" text=\"\" class=\"android.widget.RelativeLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"true\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"true\" bounds=\"[0,159][364,375]\" resource-id=\"\" instance=\"0\"><android.widget.TextView index=\"1\" text=\"Recipes\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"true\" bounds=\"[94,294][260,358]\" resource-id=\"android:id/title\" instance=\"1\"/></android.widget.RelativeLayout><android.widget.RelativeLayout index=\"1\" text=\"\" class=\"android.widget.RelativeLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"true\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[351,159][725,375]\" resource-id=\"\" instance=\"1\"><android.widget.TextView index=\"1\" text=\"Ingredients\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[422,294][655,358]\" resource-id=\"android:id/title\" instance=\"2\"/></android.widget.RelativeLayout><android.widget.RelativeLayout index=\"2\" text=\"\" class=\"android.widget.RelativeLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"true\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[712,159][1080,375]\" resource-id=\"\" instance=\"2\"><android.widget.TextView index=\"1\" text=\"Method\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[820,294][979,358]\" resource-id=\"android:id/title\" instance=\"3\"/></android.widget.RelativeLayout></android.widget.TabWidget><android.widget.FrameLayout index=\"1\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"android:id/tabcontent\" instance=\"3\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"true\" focused=\"true\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"\" instance=\"4\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"\" instance=\"2\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"android:id/content\" instance=\"5\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"\" instance=\"3\"><android.widget.TextView index=\"0\" text=\"\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,489]\" resource-id=\"caldwell.ben.bites:id/recipeheader\" instance=\"4\"/><android.widget.TextView index=\"1\" text=\"No Recipes\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,489][1080,1775]\" resource-id=\"android:id/empty\" instance=\"5\"/></android.widget.LinearLayout></android.widget.FrameLayout></android.widget.LinearLayout></android.widget.FrameLayout></android.widget.FrameLayout></android.widget.LinearLayout></android.widget.TabHost></android.widget.FrameLayout></android.widget.LinearLayout></android.widget.FrameLayout></hierarchy>"; 
	private String b = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><hierarchy rotation=\"0\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,0][1080,1775]\" resource-id=\"\" instance=\"0\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,0][1080,1775]\" resource-id=\"\" instance=\"0\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,74][1080,159]\" resource-id=\"\" instance=\"1\"><android.widget.TextView index=\"0\" text=\"Bites\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[20,78][1060,152]\" resource-id=\"android:id/title\" instance=\"0\"/></android.widget.FrameLayout><android.widget.FrameLayout index=\"1\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,1775]\" resource-id=\"android:id/content\" instance=\"2\"><android.widget.TabHost index=\"0\" text=\"\" class=\"android.widget.TabHost\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,1775]\" resource-id=\"android:id/tabhost\" instance=\"0\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,1775]\" resource-id=\"\" instance=\"1\"><android.widget.TabWidget index=\"0\" text=\"\" class=\"android.widget.TabWidget\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][1080,375]\" resource-id=\"android:id/tabs\" instance=\"0\"><android.widget.RelativeLayout index=\"0\" text=\"\" class=\"android.widget.RelativeLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"true\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,159][364,375]\" resource-id=\"\" instance=\"0\"><android.widget.TextView index=\"1\" text=\"Recipes\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[94,294][260,358]\" resource-id=\"android:id/title\" instance=\"1\"/></android.widget.RelativeLayout><android.widget.RelativeLayout index=\"1\" text=\"\" class=\"android.widget.RelativeLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"true\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"true\" bounds=\"[351,159][725,375]\" resource-id=\"\" instance=\"1\"><android.widget.TextView index=\"1\" text=\"Ingredients\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"true\" bounds=\"[422,294][655,358]\" resource-id=\"android:id/title\" instance=\"2\"/></android.widget.RelativeLayout><android.widget.RelativeLayout index=\"2\" text=\"\" class=\"android.widget.RelativeLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"true\" enabled=\"true\" focusable=\"true\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[712,159][1080,375]\" resource-id=\"\" instance=\"2\"><android.widget.TextView index=\"1\" text=\"Method\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[820,294][979,358]\" resource-id=\"android:id/title\" instance=\"3\"/></android.widget.RelativeLayout></android.widget.TabWidget><android.widget.FrameLayout index=\"1\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"android:id/tabcontent\" instance=\"3\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"true\" focused=\"true\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"\" instance=\"4\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"\" instance=\"2\"><android.widget.FrameLayout index=\"0\" text=\"\" class=\"android.widget.FrameLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"android:id/content\" instance=\"5\"><android.widget.LinearLayout index=\"0\" text=\"\" class=\"android.widget.LinearLayout\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,1775]\" resource-id=\"\" instance=\"3\"><android.widget.TextView index=\"0\" text=\"\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,375][1080,489]\" resource-id=\"caldwell.ben.bites:id/ingredientheader\" instance=\"4\"/><android.widget.TextView index=\"1\" text=\"No ingredients\" class=\"android.widget.TextView\" package=\"caldwell.ben.bites\" content-desc=\"\" checkable=\"false\" checked=\"false\" clickable=\"false\" enabled=\"true\" focusable=\"false\" focused=\"false\" scrollable=\"false\" long-clickable=\"false\" password=\"false\" selected=\"false\" bounds=\"[0,489][1080,1775]\" resource-id=\"android:id/empty\" instance=\"5\"/></android.widget.LinearLayout></android.widget.FrameLayout></android.widget.LinearLayout></android.widget.FrameLayout></android.widget.FrameLayout></android.widget.LinearLayout></android.widget.TabHost></android.widget.FrameLayout></android.widget.LinearLayout></android.widget.FrameLayout></hierarchy>";
}
